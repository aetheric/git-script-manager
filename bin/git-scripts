#!/bin/sh

loc="$( cd "$( dirname "${BASEH_SOURCE[0]}" )" && pwd )"

command="$1"

# arguments now don't include command.
shift 1

case "$command" in

	get)   exit get();;

	on)	   exit on();;

	off)   exit off();;

	purge) exit purge();;

	list)  exit list();;

	*)
		echo "Unknown command $1."
		exit 1
	;;

esac

# git scripts fetch tzrlk/git-extras git-switch
function get {

	echo "Retrieving ${1}@${2} from github..."
	repo_dir="${loc}/../repos/${1}/.git"
	
	#check if not cloned.
	if [ ! -d "$repo_dir/.git" ]; then
		mkdir $repo_dir
		git -C $repo_dir init
		git -C $repo_dir remote add origin https://github.com/${1}.git
	fi

	echo Retrieving latest updates
	git -C $repo_dir fetch origin --prune

	echo Checking-out ${2}...
	git -C $repo_dir checkout $2

}

# git scripts activate tzrlk/git-extras git-switch git-switch
function on {

	echo Creating symlink for ${loc}/../repos/$1/$2 to ${loc}/$3
	ln -s "${loc}/../repos/$1/$2" $3

}

# git scripts deactivate git-switch
function off {
	
	echo Removing ${1} from active scripts
	rm -f "${loc}/${1}"

}

# git scripts purge tzrlk/git-extras
function purge {

	repo_dir="${loc}/../repos/${1}/.git"

	echo Removing ${1} from stored repos
	rm -rf $repo_dir

}

# git scripts list
function list {

	echo Listing all stored repos.
	ls "${loc}/../repos"

	echo Listing all active scripts.
	ls "${loc}"

}

